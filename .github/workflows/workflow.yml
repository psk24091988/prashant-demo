name: Build and Deploy to GKE

on: 
  push:
    branches: 
    - 'main'

kubernetes:
  runs-on: 'ubuntu-latest'
   steps:
   - name: 'Checkout Repository'
     uses: 'actions/checkout@v2'

   - id: 'auth'
     uses: 'google-github-actions/auth@v0'
     with:
       credentials_json: '${{ secrets.prashant_creds }}'

   - name: 'Set up Cloud SDK'
       uses: 'google-github-actions/setup-gcloud@v0'

   - name: 'Use gcloud CLI for authenticating gke-cluster'
        run: 'gcloud info'

   - name: authenticating into cluster
        run: |
          gcloud config set project prashant-terraform
          gcloud container clusters get-credentials prashant-gke --region=us-central1-a
  
   - name: setup Helm
        run: |
          curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
          chmod 700 get_helm.sh
          ./get_helm.sh
          helm plugin install https://github.com/databus23/helm-diff
      
   - name: helm mychart
        run: |
          #helm upgrade prashanthelmchart ./prashant-helm/prashant-helm-chart
          #helm install prashanthelmchart ./prashant-helm/prashant-helm-chart
          helm create prashanthelmchart ./prashant-helm/prashant-helm-chart
